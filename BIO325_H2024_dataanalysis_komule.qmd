---
title: "BIO325_H2024_datanalysis_kolmule"
format: html
editor: visual
---

I utgangspunktet benytter vi oss kun av data fra årets tokt fra Nordsjøen (+ dataen som er implementert fra fjordtoktet i samme fil. )

```{r}
#| label: setup
#| message: false
#setup av pakker
library("here") #setter working direktory til å være i rot-mappen og ikke i output
library(tidyverse)
library(readr)
library(readxl)
library(viridis)
#theme_set(theme_minimal)

colors = viridis(3)
```

```{r}
#| label: import av data
#| message: false


import_NS <- read.csv(here("data", "BIO325_H2024_NS_catch_measurements.csv")) #import av all data

#vi vil ha en fil som inneholder kun kolmule

kolmule_import_ns <- import_NS |> 
  filter(commonname == "kolmule") #kun kolmuledata

kolmule_otlitter_ns <-kolmule_import_ns |> 
  mutate(Oto_available = ifelse(!is.na(sex) & !is.na(maturationstage), "Yes", "No")) #dette dasettet inneholder antallet otolitter som er samlet inn på nordsjøtoket 2024

BIO325_kolmule_otolitt_data <- read_excel(here("data", "BIO325_kolmule_otolitt_data.xlsx"), sheet = "import til r")



BIO325_kolmule_otolitt_data$fish_length <- as.numeric(BIO325_kolmule_otolitt_data$fish_length)
```


## Grafisk fremstilling

```{r}
#| label: histogram som viser tilgjengelig otolitt eller ei
#| message: false

available_otolitt_hist <- ggplot(kolmule_otlitter_ns, aes(x = length, fill = Oto_available)) +
  geom_histogram(binwidth = 0.005, color = "black") + 
   geom_vline(aes(xintercept = 0.155), color = "red", linetype = "dashed", size = 1)+ #start of first peak
  geom_vline(aes(xintercept = 0.215), color = "red", linetype = "dashed", size = 1)+ #end of first peak
  geom_vline(aes(xintercept = 0.22), color = "red", linetype = "dashed", size = 1)+ #start of second peak
  geom_vline(aes(xintercept = 0.31), color = "red", linetype = "dashed", size = 1) +
  scale_fill_viridis_d()

available_otolitt_hist

```

```{r}
#| label: histogram av som viser datofordeling
#| fig-height: 10
#| fig-width: 10

ggplot(kolmule_import_ns, aes(x = length)) +
  geom_histogram(binwidth = 0.005, fill = "skyblue", color = "black") + 
  facet_wrap(~ dttm_start) +  
  labs(title = "Histogram of Length Faceted by dttm_start",
       x = "Length",
       y = "Count") 
```

```{r}
#| label: histogram med fisk m. otolitter og fisk u. otolitter per stasjon

otolitt_hist <- ggplot(kolmule_otlitter_ns, aes(x = length, fill = Oto_available)) +
  geom_histogram(binwidth = 0.005)+#, color = "black") +
  facet_wrap(~ dttm_start)+ # Adding histogram layer
  labs(title = "Kolmule Length Distribution",
       x = "Length",
       y = "Count")

otolitt_hist
```


```{r}
#| label: fiskelengde mot otlittvekt
#| message: false


ggplot(data = BIO325_kolmule_otolitt_data, aes(x = log(fish_length), y = log(otolitt_l_weight_mg) , color = as.factor(peak_nr))) +
  geom_point() +
  labs (title = "Log otolitt vekt (mg) vs log fiskelengde (m) ",
        x = "Log fiskelengde (m)",
        y = "Log otolittvekt (mg)",
        color = "Peak-gruppe")+
  scale_color_viridis_d()
  
```

```{r}
#| label: otolittlengde mot fiskelengde
#| message: false

ggplot(data = BIO325_kolmule_otolitt_data, aes(x = log(fish_length), y = log(otolitt_l_length_mm), color = as.factor(peak_nr))) + 
  geom_point() +
  labs (x = "Log fiskelengde (m)",
        y = "Log otolittlengde (mm)",
    title = "Log otolitt lengde (mm) vs log fiskelengde (m)",
    color = "Peak-gruppe"
        )+
  scale_color_viridis_d()


```




```{r}
#| label: aldersdata plotting
#| message: false

BIO325_kolmule_otolitt_data_age <- BIO325_kolmule_otolitt_data |> 
drop_na(age)

ggplot(BIO325_kolmule_otolitt_data, aes(x = age, y = otolitt_l_length_mm , color = as.factor(peak_nr))) +
geom_point() +
labs(
y = "Otolith length (mm)", x = "Age", color = "Peak group")+
  scale_color_viridis_d()
```

```{r}
#| label: plotter otolitvekt mot aldersavelsning i kolmule
#| message: false


ggplot(BIO325_kolmule_otolitt_data, aes(x = age, y = otolitt_l_weight_mg , color = as.factor(peak_nr))) +
geom_point() +
labs(title = "Otolith weight (mg) vs age in Blue Whitting",
y = "Otolith weight (mg)", x = "Age", color = "Peak group")+
  scale_color_viridis_d()
```


```{r}
#| label: log fiskelengde + log otolitt vekt med farger som viser aldersfordeling og peaknummer
#| message: false

ggplot(data = BIO325_kolmule_otolitt_data_age, aes(x = log(fish_length), y = log(otolitt_l_weight_mg), color = as.factor(age), shape = as.factor(peak_nr))) + 
  geom_point() +
  scale_color_viridis_d() +
  labs(shape = "Peak-nr", color = "Age", y = "Log ottolith weight (mg)", x = "Log fish length (m)")+
  scale_color_viridis_d()
```

```{r}
#| label: log fiskelengde + log otolitt lengde med farger som viser aldersfordeling og peaknummer
#| message: false


ggplot(data = BIO325_kolmule_otolitt_data_age, aes(x = log(fish_length), y = log(otolitt_l_length_mm), color = as.factor(age), shape = as.factor(peak_nr))) + 
  geom_point() +
  theme_classic() +
  labs(shape = "Peak-nr", color = "Age", y = "Log ottolith weight (mg)", x = "Log fish length (m)") +
  scale_color_viridis_d()
```
