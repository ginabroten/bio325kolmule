---
title: "BIO325_H2024_datanalysis_kolmule"
format: html
editor: visual
---

```{r}
#| label: setup
#| message: false

library("here") #setting working diectory
library(tidyverse)
library(readr)
library(readxl)
library(viridis)
library(patchwork)

theme_set(theme_minimal())
```

```{r}
#| label: import and tidying of input dat
#| message: false


import_NS <- read.csv(here("data", "BIO325_H2024_NS_catch_measurements.csv")) #import of all data

#want a data frame with only blue whtiing/kolmule

kolmule_import_ns <- import_NS |> 
  filter(commonname == "kolmule") #only kolmule

kolmule_otolitter_ns <-kolmule_import_ns |> 
  mutate(Oto_available = ifelse(!is.na(sex) & !is.na(maturationstage), "Yes", "No")) #this dataframe will show the number of fish with otoliths, due to us only collecting otoliths & sexing the first 30

kolmule_otolitt_agedata <- read_excel(here("data", "BIO325_kolmule_otolitt_data.xlsx"), sheet = "first_agereading") #import of the age-readings

kolmule_otolitt_agedata$fish_length <- as.numeric(kolmule_otolitt_agedata$fish_length) #setting them as numbers

#after doing a first age reading, we decided to do a supplimentary agereading on the first peak
kolmule_second_agereading_import <- read_excel(
  here("data/BIO325_kolmule_otolitt_data.xlsx"), 
  sheet = "second_agereading", 
  col_types = "guess"
)
kolmule_second_agereading <- kolmule_second_agereading_import |> 
  mutate(midpeak1 = ifelse(Otolitt_nr %in% c(55, 51, 12, 54, 52), "Second", "First")) #creating new colums that displays if the otoliths were a part of the first or second age-reading

```

## Graphical exploration of the data

```{r}
#| label: histogram of fish length
#| message: false
#| warning: false

#from looking at the disturbuted data, two peaks were decided to be utlizied to group the data furtheron - here marked by the red dashed line. 

otolitt_hist <- ggplot(kolmule_otolitter_ns, aes(x = length)) +
  geom_histogram(binwidth = 0.005, color = "black", fill = "dodgerblue") + 
   geom_vline(aes(xintercept = 0.155), color = "red", linetype = "dashed", size = 1)+ #start of first peak
  geom_vline(aes(xintercept = 0.215), color = "red", linetype = "dashed", size = 1)+ #end of first peak
  geom_vline(aes(xintercept = 0.22), color = "red", linetype = "dashed", size = 1)+ #start of second peak
  geom_vline(aes(xintercept = 0.31), color = "red", linetype = "dashed", size = 1) +
  labs(x = "Fish length [m]",
       y = "Count")

otolitt_hist

```


```{r}
#| label: fiskelengde mot otlittvekt
#| message: false

#creating a plot displaying the relationship beteween fish length and otlith weigth 
kolmule_otovekt_fisklengde <- ggplot(data = kolmule_otolitt_agedata, aes(x = log(fish_length), y = log(otolitt_l_weight_mg) , color = as.factor(peak_nr))) + #using log scale to better visualise the realtionship
  geom_point() +
  labs (title = "A",
        x = "log(Fish Length [m])",
        y = "log(Otolith Weight [mg])",
        color = "Peak number")+
    guides(color = "none") +
  scale_color_manual(values = c("1" = "dodgerblue4", "2" = "lightskyblue"))
  
```

```{r}
#| label: otolittlengde mot fiskelengde
#| message: false

#plotting the fish length against the otolith length, here also in the log scale
kolmule_fisklengde_otolengde <- ggplot(data = kolmule_otolitt_agedata, aes(x = log(fish_length), y = log(otolitt_l_length_mm), color = as.factor(peak_nr))) + 
  geom_point() +
  labs (title  = "B",
    x = "log(Fish Length [m])",
        y = "log(Otolith Length [mm])",
    color = "Peak number"
        ) +
   scale_color_manual(values = c("1" = "dodgerblue4", "2" = "lightskyblue"))

```

```{r}
#| label: plotting both plots together with the framework package
#| message: false
#| warning: false


kolmule_otovekt_fisklengde + kolmule_fisklengde_otolengde


```




```{r}
#| label: agereading plots sorted by age
#| message: false
#| warning: false

#creating a plot that displays the different age-groups, and the color shows what peak they belong to, alongside the shape that entails what part of the age reading they belong to

kolmule_alder_otolengde <- ggplot(data=kolmule_second_agereading) + 
  geom_point(aes(x = age , y = otolitt_l_length_mm, color = as.factor(peak_nr), shape=midpeak1), size = 2.5,alpha = 0.7) +
  labs(x = "Age",
       y = "Otolith Length [mm]",
       colour = "Peak number",
       shape = "Age reading") +
  scale_color_manual(values = c("1" = "dodgerblue4", "2" = "lightskyblue")) 



kolmule_alder_otolengde
```












